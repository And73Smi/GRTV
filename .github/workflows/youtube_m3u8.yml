name: Update YouTube M3U8
on:
  schedule:
    - cron: '*/30 * * * *'
  workflow_dispatch:

jobs:
  get_link:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Extract M3U8 via Invidious API
        run: |
          # Χρησιμοποιούμε ένα δημόσιο instance του Invidious για να πάρουμε το m3u8
          # Το uWIhV9gQClg είναι το ID του βίντεο
          VIDEO_ID="uWIhV9gQClg"
          
          # Δοκιμάζουμε να πάρουμε το stream URL
          RESULT=$(curl -s "https://invidious.projectsegfau.lt" | jq -r '.hlsUrl // empty')
          
          if [ -z "$RESULT" ]; then
            # Εναλλακτικό instance αν το πρώτο αποτύχει
            RESULT=$(curl -s "https://iv.ggtyler.dev" | jq -r '.hlsUrl // empty')
          fi

          if [ -z "$RESULT" ]; then
            echo "Failed to extract link from all instances"
            exit 1
          else
            echo "$RESULT" > live.m3u8
            echo "Link extracted: $RESULT"
          fi

      - name: Commit and Push
        run: |
          git config --global user.name "GitHub Action"
          git config --global user.email "action@github.com"
          git add live.m3u8
          git commit -m "Update via Invidious Proxy" || exit 0
          git push





